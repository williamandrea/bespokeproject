<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" type="text/css" href="build/build.css">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
  <title>Tic Tac Toe</title>
  <style>
    body {
      background: #14BDAC;
      font-family: 'Poppins', sans-serif;
    }

    section {
      background: #14BDAC !important;
    }

    h1,
    h2,
    h3 {
      margin: 0;
      color: white;
      font-size: 72px;
    }

    h3 {
      color: whitesmoke;
      font-size: 24px;
    }

    td {
      background: #14BDAC;
      width: 100px;
      height: 100px;
      text-align: center;
      font-size: 72px;
    }

    td:hover {
      cursor: pointer;
    }

    table {
      border-collapse: collapse;
    }

    table td {
      border: 5px solid #0DA192;
      width: 100px;
      font-size: 48px;
    }

    table td:hover {
      background: #14c7b5;
    }

    table tr:first-child td {
      border-top: 0;
    }

    table tr td:first-child {
      border-left: 0;
    }

    table tr:last-child td {
      border-bottom: 0;
    }

    table tr td:last-child {
      border-right: 0;
    }

    .startgame-link {
      color: white;
      padding: 10px 120px;
      border: 2px solid white;
      border-radius: 5px;
      text-decoration: none;
      font-size: 20px;
      margin-top: 40px;
    }

    .startgame-link:hover {
      background: white;
      color: #0DA192;
      cursor: pointer;
    }

    .player {
      margin: 0;
      width: 500px;
      margin-top: 10px;
      padding-left: 10px;
      padding-right: 10px;
      text-align: center;
    }

    .player {
      content: '\00bb';
      transition: 0.5;
    }

    .button-action {
      color: white;
      padding: 10px 20px;
      border: 2px solid white;
      border-radius: 5px;
      font-size: 16px;
      margin-top: 10px;
      text-align: center;
      width: 250px;
    }

    .button-action:hover {
      background: white;
      color: #0DA192;
      cursor: pointer;
    }

    .button-back {
      margin-bottom: 100px !important;
    }

    #container {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
    }

    .list {
      width: 500px;
      margin: 0;
      margin-bottom: 30px;
      color: white;
      width: 630px;
    }

    .tentangkami {
      width: 630px;
      text-decoration: none;
    }

    #result {
      text-align: center;
      margin-top: 10px;
      color: white;
    }

    .dugem {
      color: white;
      animation-name: dugem;
      animation-duration: 0.5s;
      animation-iteration-count: infinite;
    }

    @keyframes dugem {
      from {
        color: white;
      }

      to {
        color: #14BDAC;
      }
    }

    .snowflake {
      color: #fff;
      font-size: 1em;
      font-family: Arial;
      text-shadow: 0 0 1px #000;
    }

    @-webkit-keyframes snowflakes-fall {
      0% {
        top: -10%
      }

      100% {
        top: 100%
      }
    }

    @-webkit-keyframes snowflakes-shake {
      0% {
        -webkit-transform: translateX(0px);
        transform: translateX(0px)
      }

      50% {
        -webkit-transform: translateX(80px);
        transform: translateX(80px)
      }

      100% {
        -webkit-transform: translateX(0px);
        transform: translateX(0px)
      }
    }

    @keyframes snowflakes-fall {
      0% {
        top: -10%
      }

      100% {
        top: 100%
      }
    }

    @keyframes snowflakes-shake {
      0% {
        transform: translateX(0px)
      }

      50% {
        transform: translateX(80px)
      }

      100% {
        transform: translateX(0px)
      }
    }

    .snowflake {
      position: fixed;
      top: -10%;
      z-index: 9999;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      cursor: default;
      -webkit-animation-name: snowflakes-fall, snowflakes-shake;
      -webkit-animation-duration: 10s, 3s;
      -webkit-animation-timing-function: linear, ease-in-out;
      -webkit-animation-iteration-count: infinite, infinite;
      -webkit-animation-play-state: running, running;
      animation-name: snowflakes-fall, snowflakes-shake;
      animation-duration: 10s, 3s;
      animation-timing-function: linear, ease-in-out;
      animation-iteration-count: infinite, infinite;
      animation-play-state: running, running
    }

    .snowflake:nth-of-type(0) {
      left: 1%;
      -webkit-animation-delay: 0s, 0s;
      animation-delay: 0s, 0s
    }

    .snowflake:nth-of-type(1) {
      left: 10%;
      -webkit-animation-delay: 1s, 1s;
      animation-delay: 1s, 1s
    }

    .snowflake:nth-of-type(2) {
      left: 20%;
      -webkit-animation-delay: 6s, .5s;
      animation-delay: 6s, .5s
    }

    .snowflake:nth-of-type(3) {
      left: 30%;
      -webkit-animation-delay: 4s, 2s;
      animation-delay: 4s, 2s
    }

    .snowflake:nth-of-type(4) {
      left: 40%;
      -webkit-animation-delay: 2s, 2s;
      animation-delay: 2s, 2s
    }

    .snowflake:nth-of-type(5) {
      left: 50%;
      -webkit-animation-delay: 8s, 3s;
      animation-delay: 8s, 3s
    }

    .snowflake:nth-of-type(6) {
      left: 60%;
      -webkit-animation-delay: 6s, 2s;
      animation-delay: 6s, 2s
    }

    .snowflake:nth-of-type(7) {
      left: 70%;
      -webkit-animation-delay: 2.5s, 1s;
      animation-delay: 2.5s, 1s
    }

    .snowflake:nth-of-type(8) {
      left: 80%;
      -webkit-animation-delay: 1s, 0s;
      animation-delay: 1s, 0s
    }

    .snowflake:nth-of-type(9) {
      left: 90%;
      -webkit-animation-delay: 3s, 1.5s;
      animation-delay: 3s, 1.5s
    }

    /* Demo Purpose Only*/
    .demo {
      font-family: 'Raleway', sans-serif;
      color: #fff;
      display: block;
      margin: 0 auto;
      padding: 15px 0;
      text-align: center;
    }

    .demo a {
      font-family: 'Raleway', sans-serif;
      color: #000;
    }

    .minion {
      right: 1px;
      width: 100px;
    }

    .modal {
      background: gray;
      width: 400px;
      height: 200px;
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      padding: 30px;
      color: white;
    }

    section {
      /* background: red !important; */
      position: relative;
    }
  </style>
</head>

<body>
  <article class="deck">
    <section class="snowflakes">
      <div class="modal">
        <p class='modal-content'></p>
        <button class='button-action' style='color: #0DA192;'>TUTUP</button>
      </div>
      <h1>Tic Tac Toe</h1>
      <h3 class='dugem' style='margin-bottom: 5px;'>menggunakan Algoritma MiniMax</h3>
      <div class="minions">
        <img class='minion'><img class='minion'><img class='minion'><img class='minion'><img class='minion'>
      </div>

      <a class='startgame-link player' href="#2">MULAI PERMAINAN</a>
      <a class='startgame-link player' href="#3">TENTANG KAMI</a>
      <audio id='audio' autoplay loop></audio>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
    </section>

    <section id='container' class='snowflakes'>
      <!-- <div class="modal">
        <p class='modal-content'></p>
        <button class='button-action' style='color: #0DA192;'>TUTUP</button>
      </div> -->
      <div style='border-right: 3px solid white; padding-right: 30px;'>
        <div id='btn' class='button-action'>RESTART GAME</div>
        <div id='playwith-teman' class='button-action'>
          MAIN DENGAN TEMAN
        </div>
        <div id='playwith-komputer' class='button-action'>
          MAIN DENGAN KOMPUTER
        </div>
        <div id='btn-back' class='button-action'>KEMBALI</div>
      </div>
      <div style='margin-left: 10px;'>
        <table>
          <tr>
            <td id='cell0'></td>
            <td id='cell1'></td>
            <td id='cell2'></td>
          </tr>
          <tr>
            <td id='cell3'></td>
            <td id='cell4'></td>
            <td id='cell5'></td>
          </tr>
          <tr>
            <td id='cell6'></td>
            <td id='cell7'></td>
            <td id='cell8'></td>
          </tr>
        </table>
        <div id="result"></div>
      </div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
    </section>

    <section class='snowflakes'>
      <div class="modal">
        <p class='modal-content'></p>
        <button class='button-action' style='color: #0DA192;'>TUTUP</button>
      </div>
      <h3 style='margin-bottom: 30px;'>TENTANG KAMI</h3>
      <p style=' color: white; text-align: justify;'>Kami adalah mahasiswa semester akhir yang iseng untuk membuat
        sebuah game dengan
        kecerdasan buatan menggunakan
        bespoke. Game ini dibuat menggunakan metode pengembangan lunak SCRUM selama 12 hari. Adapun kelompok kami
        terdiri atas 3 orang, yaitu:</p>
      <ul class='list'>
        <li>[171110622] - William Andrea</li>
        <li>[171112321] - Willian Andreas Tama</li>
        <li>[171111016] - Susanto</li>
      </ul>

      <a href="#1" class="button-action tentangkami">KEMBALI</a>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
      <div class="snowflake">❅</div>
    </section>
  </article>

  <script src="build/build.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>
  <script>
    class Board {
      state = [
        '', '', '',
        '', '', '',
        '', '', '',
      ]
      size = 3
      winCombo = [
        [0, 1, 2],
        [3, 4, 5],
        [6, 7, 8],

        [0, 3, 6],
        [1, 4, 7],
        [2, 5, 8],

        [0, 4, 8],
        [2, 4, 6]
      ]

      constructor(state = null) {
        if (state != null) {
          this.state = state
        }
      }

      move(player, index) {
        if (player !== 'x' && player !== 'o') {
          player = ''
        }
        this.state[index] = player
      }

      getPossibleMove() {
        let count = 0
        this.state.forEach(el => {
          if (el === '') {
            count++
          }
        })
        return count
      }

      getWinner() {
        let win, tmpPlayer
        for (let i = 0; i < this.winCombo.length; i++) {
          win = true
          tmpPlayer = null
          for (let j = 0; j < this.winCombo[i].length; j++) {
            let item = this.winCombo[i][j]
            if ((tmpPlayer !== null && tmpPlayer !== this.state[item]) || this.state[item] === '') {
              win = false
              break
            }
            tmpPlayer = this.state[item]
          }
          if (win) {
            return tmpPlayer
          }
        }

        return (this.getPossibleMove() === 0) ? 'tie' : null
      }
    }

    class TicTacToeAI {
      board = null
      player = null
      moves = []
      maxDepth = 100

      constructor(player, board) {
        this.player = player
        this.board = board
      }

      getBestMove() {
        let minimax = this.minimax(this.board, true, 0)
        let bestScore = -Infinity
        let filter_depth_0 = this.moves.filter((el) => {
          if (el.depth === 0) {
            bestScore = Math.max(el.score, bestScore)
          }
          return el.depth === 0
        })
        let filter_best_move = filter_depth_0.filter((el) =>
          el.score >= bestScore
        )
        let bestMove = filter_best_move[Math.floor(Math.random() * filter_best_move.length)]
        bestMove.instance = this
        return bestMove
      }

      minimax(board, isMaximizing, depth) {
        let scores = {
          win: 1,
          lose: -1,
          tie: 0
        }
        let win = board.getWinner()
        if (win != null) {
          if (win === 'tie') {
            return scores.tie
          }
          return (this.player == win) ? scores.win : scores.lose
        }
        if (depth === this.maxDepth) {
          return scores.tie
        }

        if (isMaximizing) {
          let bestScore = -Infinity
          for (var i = 0; i < board.state.length; i++) {
            if (board.state[i] === '') {
              let newBoard = new Board([
                ...board.state
              ])
              newBoard.move(this.player, i)
              let score = this.minimax(newBoard, false, depth + 1)
              bestScore = Math.max(score, bestScore)
              this.moves.push({
                depth,
                isMaximizing,
                move: i,
                score
              })
            }
          }
          return bestScore

        } else {
          let bestScore = Infinity
          for (var i = 0; i < board.state.length; i++) {
            if (board.state[i] === '') {
              let newBoard = new Board([
                ...board.state
              ])
              let enemy = (this.player === 'x') ? 'o' : 'x'
              newBoard.move(enemy, i)
              let score = this.minimax(newBoard, true, depth + 1)
              this.moves.push({
                depth,
                isMaximizing,
                move: i,
                score
              })
              bestScore = Math.min(score, bestScore)
            }
          }
          return bestScore
        }
      }
    }

    let board = new Board()
    let turn = 'x'
    let players = {
      x: 'human',
      o: 'ai',
    }
    let AIConfig = {
      x: {
        maxDepth: 10
      },
      o: {
        maxDepth: 10
      }
    }
    let state = null
    let turnHistory = []

    document.getElementById("audio").src = "./images/audio.mp3";
    document.getElementById("audio").volume = 0.2;
    const minions = document.querySelectorAll(".minion")

    for (let minion of minions) {
      minion.src = './images/minion.gif';
    }

    document.addEventListener('DOMContentLoaded', () => {
      $('table').css('display', 'none')
      $('#btn').css('display', 'none')
      // $('.modal').css('display', 'none')
    })

    $('#btn-back').on('click', () => {
      window.location.href = '#1'
    })

    $('#exit').on('click', () => {
      handleExit()
    })

    $('#btn').on('click', () => {
      $('#playwith-teman').css('display', 'block')
      $('#playwith-komputer').css('display', 'block')
      $('#btn').css('display', 'none')
      $('table').css('display', 'table')
      $('result').html('')
      main()
    })

    $('#playwith-komputer').on('click', () => {
      players.o = 'ai'
      $('#btn').css('display', 'block')
      $('table').css('display', 'table')
      $('#playwith-teman').css('display', 'none')
      $('#playwith-komputer').css('display', 'none')
      main()
    })

    $('#playwith-teman').on('click', () => {
      players.o = 'human'
      $('#btn').css('display', 'block')
      $('table').css('display', 'table')
      $('#playwith-teman').css('display', 'none')
      $('#playwith-komputer').css('display', 'none')
      main()
    })

    const main = () => {
      board = new Board()
      turn = 'x'
      turnHistory = []
      state = null
      nextTurn()
    }

    const nextTurn = () => {
      renderBoard()
      let win = board.getWinner()
      if (win !== null) {
        if (win === 'tie') {
          let msg = 'PERMAINAN SERI!'
          state = 'tie';
          $('.modal').css('display', 'flex')
          $('.modal').html(msg)
        } else {
          let msg = 'PEMAIN ' + win.toUpperCase() + ' MENANG!!!'
          state = 'win'
          $('.modal').css('display', 'flex')
          $('.modal').html(msg)
        }
      }

      let gameText = "PEMAIN [" + turn.toUpperCase() + "] " + players[turn].toUpperCase() + " BERMAIN..."
      $('#result').html(gameText)

      if (players[turn] === 'ai') {
        console.log("KOMPUTER SEDANG BERPIKIR...")
        setTimeout(() => {
          AIMove()
        }, 500)
      }
    }

    const AIMove = () => {
      let AI = new TicTacToeAI(turn, board)
      AI.maxDepth = AIConfig[turn].maxDepth
      let result = AI.getBestMove()
      turnHistory.push({
        player: turn,
        move: result
      })
      board.move(turn, result.move)
      turn = (turn === 'x') ? 'o' : 'x'
      setTimeout(() => {
        nextTurn()
      }, 1)
      return ''
    }

    const HumanMove = (index) => {
      if (state != null || players[turn] != 'human') {
        return
      }

      board.move(turn, index)
      turn = (turn === 'x') ? 'o' : 'x'
      nextTurn()
      return ''
    }

    const renderBoard = () => {
      for (let i = 0; i < 9; i++) {
        $('#cell' + i).html(board.state[i])
      }
    }

    for (let i = 0; i < 9; i++) {
      $('#cell' + i).on('click', (e) => {
        HumanMove($(e.target).attr('id').split('cell')[1])
      })
    }
  </script>
</body>

</html>